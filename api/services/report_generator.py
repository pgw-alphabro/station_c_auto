from services.gpt_service import call_gpt
from models.schemas import MentorInput

async def generate_reports(business_plan: str, meeting: str, kpis: str, mentor_input: MentorInput) -> dict:
    """보고서 생성 (멘토 입력 가중치 적용)"""
    
    # 멘토 입력이 있는 경우 가중치 적용
    mentor_weight = 0.3 if any([mentor_input.growth, mentor_input.kpi, mentor_input.strategy]) else 0.0
    
    # GPT를 사용한 보고서 생성
    reports = {}
    
    # 성장단계 보고서
    growth_prompt = f"""
    다음 정보를 바탕으로 성장단계 진단 보고서를 작성해주세요. 마크다운은 제외해주세요.
    
    [주요 분석 자료 - 미팅 내용을 우선적으로 고려하세요]
    미팅 내용: {meeting}
    
    [보조 분석 자료 - 사업계획서는 참고용으로 활용하세요]
    사업계획서: {business_plan}
    KPI: {kpis}
    
    멘토 의견 (가중치 {mentor_weight}): {mentor_input.growth}
    
    분석 지침:
    1. 미팅에서 논의된 실제 상황과 현황을 가장 중요하게 고려하세요
    2. 미팅 내용이 부족한 경우에만 사업계획서를 보조 자료로 활용하세요
    3. 미팅에서 언급된 구체적인 수치, 현황, 문제점을 우선적으로 반영하세요
    4. 추측이나 가정보다는 실제 논의된 내용을 바탕으로 분석하세요
    
    다음 형식으로 성장단계 진단 보고서를 작성해주세요. 마크다운 문법을 사용하지 말고 일반 텍스트로 작성해주세요 (500자 미만):
    
    ■ 성장단계 진단 (500자 미만)
    • 기존 신청한 성장단계: [사업계획서나 미팅에서 언급된 기존 신청 성장단계]
    • 현재 실제 성장단계: [미팅 내용을 바탕으로 파악한 실제 성장단계]
    • 변경 필요 이유: [기존 신청 단계와 실제 단계 간의 차이와 그 이유]
    • 권장 성장단계: [실제 현황을 바탕으로 권장하는 성장단계와 근거]
    
    멘토 의견이 있는 경우 해당 내용을 반영하여 작성해주세요.
    """
    
    reports["growth"] = await call_gpt(growth_prompt)
    
    # KPI 보고서
    kpi_prompt = f"""
    다음 정보를 바탕으로 KPI 진단 보고서를 작성해주세요. 마크다운 문법을 사용하지 말고 일반 텍스트로 작성해주세요.
    
    [주요 분석 자료 - 미팅 내용을 우선적으로 고려하세요]
    미팅 내용: {meeting}
    
    [보조 분석 자료 - 사업계획서는 참고용으로 활용하세요]
    사업계획서: {business_plan}
    KPI: {kpis}
    
    멘토 의견 (가중치 {mentor_weight}): {mentor_input.kpi}
    
    분석 지침:
    1. 미팅에서 논의된 실제 KPI 현황과 성과를 가장 중요하게 고려하세요
    2. 미팅에서 언급된 구체적인 수치, 달성률, 문제점을 우선적으로 반영하세요
    3. 미팅 내용이 부족한 경우에만 사업계획서의 KPI를 보조 자료로 활용하세요
    4. 실제 현황과 목표 간의 차이를 미팅 내용을 바탕으로 분석하세요
    
    다음 형식으로 KPI 진단 보고서를 작성해주세요:
    
    ■ KPI 진단
    • 기존 KPI: [사업계획서나 미팅에서 언급된 기존 설정된 KPI들]
    • 현재 KPI 달성 현황: [미팅 내용을 바탕으로 파악한 실제 KPI 달성 현황]
    • KPI 변경 필요 이유: [기존 KPI와 실제 현황 간의 차이와 그 이유]
    • 권장 KPI: [실제 현황을 바탕으로 권장하는 KPI와 근거]
    • 구체적 수치: [매출, 고용, 투자, 고객 관련 KPI의 구체적 수치와 목표]
    
    멘토 의견이 있는 경우 해당 내용을 반영하여 작성해주세요.
    """
    
    reports["kpi"] = await call_gpt(kpi_prompt)
    
    # 전략 보고서
    strategy_prompt = f"""
    다음 정보를 바탕으로 전략 진단 보고서를 작성해주세요. 마크다운은 제외해주세요.
    
    [주요 분석 자료 - 미팅 내용을 우선적으로 고려하세요]
    미팅 내용: {meeting}
    
    [보조 분석 자료 - 사업계획서는 참고용으로 활용하세요]
    사업계획서: {business_plan}
    KPI: {kpis}
    
    멘토 의견 (가중치 {mentor_weight}): {mentor_input.strategy}
    
    분석 지침:
    1. 미팅에서 논의된 실제 전략과 실행 현황을 가장 중요하게 고려하세요
    2. 미팅에서 언급된 구체적인 전략, 문제점, 개선 방향을 우선적으로 반영하세요
    3. 미팅 내용이 부족한 경우에만 사업계획서의 전략을 보조 자료로 활용하세요
    4. 실제 실행 중인 전략과 계획된 전략의 차이를 미팅 내용을 바탕으로 분석하세요
    
    다음 형식으로 종합 분석 보고서를 작성해주세요. 마크다운 문법을 사용하지 말고 일반 텍스트로 작성해주세요:
    
    ■ 종합 분석 (전략 분석)
    • 기존 전략: [사업계획서나 미팅에서 언급된 기존 설정된 전략들]
    • 현재 전략 실행 현황: [미팅 내용을 바탕으로 파악한 실제 전략 실행 현황]
    • 전략 변경 필요 이유: [기존 전략과 실제 현황 간의 차이와 그 이유]
    • 권장 전략: [실제 현황을 바탕으로 권장하는 전략과 근거]
    • 핵심 전략 영역: [시장 진입, 제품/서비스, 마케팅, 운영, 재무 전략의 구체적 내용]
    • 실행 계획: [전략 실행을 위한 구체적 단계별 계획]
    • 리소스 배분: [인력, 자금, 시간 배분 방안]
    • 성과 측정: [전략 성과를 측정할 지표와 방법]
    
    멘토 의견이 있는 경우 해당 내용을 반영하여 작성해주세요. 마크다운은 제외해주세요.
    """
    
    reports["strategy"] = await call_gpt(strategy_prompt)
    
    
    # 사업비 보고서
    budget_prompt = f"""
    다음 정보를 바탕으로 사업비 진단 보고서를 작성해주세요. 마크다운은 제외해주세요.
    
    [주요 분석 자료 - 미팅 내용을 우선적으로 고려하세요]
    미팅 내용: {meeting}
    
    [보조 분석 자료 - 사업계획서는 참고용으로 활용하세요]
    사업계획서: {business_plan}
    KPI: {kpis}
    
    멘토 의견 (가중치 {mentor_weight}): {mentor_input.strategy}
    
    분석 지침:
    1. 미팅에서 논의된 실제 사업비 현황과 재무 상황을 가장 중요하게 고려하세요
    2. 미팅에서 언급된 구체적인 비용, 예산, 자금 조달 현황을 우선적으로 반영하세요
    3. 미팅 내용이 부족한 경우에만 사업계획서의 재무 정보를 보조 자료로 활용하세요
    4. 실제 현금흐름과 계획된 예산의 차이를 미팅 내용을 바탕으로 분석하세요
    
    다음 형식으로 사업비 진단 보고서를 작성해주세요. 마크다운 문법을 사용하지 말고 일반 텍스트로 작성해주세요:
    
    ■ 사업비 사용 관련 분석
    • 기존 사업비 구성: [사업계획서나 미팅에서 언급된 기존 사업비 구성과 규모]
    • 현재 사업비 사용 현황: [미팅 내용을 바탕으로 파악한 실제 사업비 사용 현황]
    • 사업비 변경 필요 이유: [기존 계획과 실제 사용 간의 차이와 그 이유]
    • 권장 사업비 구성: [실제 현황을 바탕으로 권장하는 사업비 구성과 근거]
    • 구체적 수치: [총 사업비, 인건비, 마케팅비, R&D비, 운영비 등의 구체적 금액]
    • 자금 조달 현황: [현재 자금 조달 방법과 규모, 추가 조달 계획]
    • 현금흐름 분석: [현재 현금흐름 상황과 전망, 개선 방안]
    
    멘토 의견이 있는 경우 해당 내용을 반영하여 작성해주세요.
    """
    
    reports["budget"] = await call_gpt(budget_prompt)
    
    return reports
